{"ast":null,"code":"import { createElement, Fragment, Component, PureComponent, createContext } from 'react';\nimport memoize from 'lodash/memoize';\nimport { renderAndAddProps } from 'render-and-add-props';\nimport produce$1, { produce } from 'immer';\nimport sortBy from 'lodash/sortBy';\nimport keys from 'lodash/keys';\nimport set from 'lodash/set';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\n\n/* global Reflect, Promise */\n\nvar _extendStatics = function extendStatics(d, b) {\n  _extendStatics = Object.setPrototypeOf || {\n    __proto__: []\n  } instanceof Array && function (d, b) {\n    d.__proto__ = b;\n  } || function (d, b) {\n    for (var p in b) {\n      if (b.hasOwnProperty(p)) d[p] = b[p];\n    }\n  };\n\n  return _extendStatics(d, b);\n};\n\nfunction __extends(d, b) {\n  _extendStatics(d, b);\n\n  function __() {\n    this.constructor = d;\n  }\n\n  d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n}\n\nvar _assign = function __assign() {\n  _assign = Object.assign || function __assign(t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return _assign.apply(this, arguments);\n};\n\nfunction __awaiter(thisArg, _arguments, P, generator) {\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : new P(function (resolve) {\n        resolve(result.value);\n      }).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nfunction __generator(thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function sent() {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) {\n      try {\n        if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n        if (y = 0, t) op = [op[0] & 2, t.value];\n\n        switch (op[0]) {\n          case 0:\n          case 1:\n            t = op;\n            break;\n\n          case 4:\n            _.label++;\n            return {\n              value: op[1],\n              done: false\n            };\n\n          case 5:\n            _.label++;\n            y = op[1];\n            op = [0];\n            continue;\n\n          case 7:\n            op = _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n\n          default:\n            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n              _ = 0;\n              continue;\n            }\n\n            if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n              _.label = op[1];\n              break;\n            }\n\n            if (op[0] === 6 && _.label < t[1]) {\n              _.label = t[1];\n              t = op;\n              break;\n            }\n\n            if (t && _.label < t[2]) {\n              _.label = t[2];\n\n              _.ops.push(op);\n\n              break;\n            }\n\n            if (t[2]) _.ops.pop();\n\n            _.trys.pop();\n\n            continue;\n        }\n\n        op = body.call(thisArg, _);\n      } catch (e) {\n        op = [6, e];\n        y = 0;\n      } finally {\n        f = t = 0;\n      }\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n}\n\nvar firebaseDatabaseDefaultContext = {\n  firebase: {}\n};\nvar getContext = memoize(function (createContext$$1) {\n  if (createContext$$1 === void 0) {\n    createContext$$1 = function createContext$$1(defaultContext) {\n      return createContext(defaultContext);\n    };\n  }\n\n  var _a = createContext$$1(firebaseDatabaseDefaultContext),\n      FirebaseDatabaseContextProvider = _a.Provider,\n      FirebaseDatabaseContextConsumer = _a.Consumer;\n\n  return {\n    FirebaseDatabaseContextProvider: FirebaseDatabaseContextProvider,\n    FirebaseDatabaseContextConsumer: FirebaseDatabaseContextConsumer\n  };\n}, function () {\n  return 1;\n});\n\nvar initializeFirebaseApp = function initializeFirebaseApp(_a) {\n  var firebase = _a.firebase,\n      authDomain = _a.authDomain,\n      databaseURL = _a.databaseURL,\n      projectId = _a.projectId,\n      storageBucket = _a.storageBucket,\n      messagingSenderId = _a.messagingSenderId,\n      apiKey = _a.apiKey,\n      appId = _a.appId,\n      measurementId = _a.measurementId;\n\n  try {\n    firebase.initializeApp({\n      apiKey: apiKey,\n      authDomain: authDomain,\n      databaseURL: databaseURL,\n      projectId: projectId,\n      storageBucket: storageBucket,\n      messagingSenderId: messagingSenderId,\n      appId: appId,\n      measurementId: measurementId\n    });\n  } catch (err) {\n    if (err.code !== \"app/duplicate-app\") {\n      throw err;\n    }\n  }\n};\n\nvar FirebaseDatabaseProvider = function (_super) {\n  __extends(FirebaseDatabaseProvider, _super);\n\n  function FirebaseDatabaseProvider(props) {\n    var _this = _super.call(this, props) || this;\n\n    _this.__isMounted = true;\n    _this.state = {\n      firebase: props.firebase\n    };\n\n    if (_this.props.apiKey) {\n      initializeFirebaseApp(_this.props);\n    }\n\n    return _this;\n  }\n\n  FirebaseDatabaseProvider.prototype.render = function () {\n    var _a = this.props,\n        children = _a.children,\n        createContext$$1 = _a.createContext;\n    var FirebaseDatabaseContextProvider = getContext(createContext$$1).FirebaseDatabaseContextProvider;\n    return createElement(FirebaseDatabaseContextProvider, {\n      value: this.state\n    }, renderAndAddProps(children, {}));\n  };\n\n  return FirebaseDatabaseProvider;\n}(Component);\n\nvar getFirebaseQuery = function getFirebaseQuery(_a) {\n  var _b = _a.firebase,\n      firebase = _b === void 0 ? null : _b,\n      path = _a.path,\n      _c = _a.orderByChild,\n      orderByChild = _c === void 0 ? null : _c,\n      _d = _a.orderByKey,\n      orderByKey = _d === void 0 ? null : _d,\n      _e = _a.orderByValue,\n      orderByValue = _e === void 0 ? null : _e,\n      _f = _a.limitToFirst,\n      limitToFirst = _f === void 0 ? null : _f,\n      _g = _a.limitToLast,\n      limitToLast = _g === void 0 ? null : _g,\n      _h = _a.startAt,\n      startAt = _h === void 0 ? null : _h,\n      _j = _a.endAt,\n      endAt = _j === void 0 ? null : _j,\n      _k = _a.equalTo,\n      equalTo = _k === void 0 ? null : _k;\n\n  if (firebase === null) {\n    throw new Error(\"Need to supply firebase argument to getFirebaseQuery\");\n  }\n\n  if (path === null || typeof path === \"undefined\") {\n    throw new Error(\"Need to supply path argument to getFirebaseQuery\");\n  }\n\n  var result = firebase.database().ref(path);\n\n  if (orderByChild !== null) {\n    result = result.orderByChild(orderByChild);\n  }\n\n  if (orderByKey !== null) {\n    result = result.orderByKey();\n  }\n\n  if (orderByValue !== null) {\n    result = result.orderByValue();\n  }\n\n  if (limitToFirst !== null) {\n    result = result.limitToFirst(limitToFirst);\n  }\n\n  if (limitToLast !== null) {\n    result = result.limitToLast(limitToLast);\n  }\n\n  if (startAt !== null) {\n    result = result.startAt(startAt);\n  }\n\n  if (endAt !== null) {\n    result = result.endAt(endAt);\n  }\n\n  if (equalTo !== null) {\n    result = result.equalTo(equalTo);\n  }\n\n  return result;\n};\n\nvar dataNodeProps = [\"firebase\", \"path\", \"orderByChild\", \"orderByKey\", \"orderByValue\", \"limitToFirst\", \"limitToLast\", \"startAt\", \"endAt\", \"equalTo\", \"keysOnly\", \"once\", \"isList\", \"unsub\"];\n\nvar getPropsOrNull = function getPropsOrNull(props) {\n  var cleanProps = {};\n\n  for (var _i = 0, dataNodeProps_1 = dataNodeProps; _i < dataNodeProps_1.length; _i++) {\n    var propName = dataNodeProps_1[_i];\n\n    if (props[propName]) {\n      cleanProps[propName] = props[propName];\n    } else {\n      cleanProps[propName] = null;\n    }\n  }\n\n  return cleanProps;\n};\n\nvar havePropsChanged = function havePropsChanged(prevProps, props) {\n  for (var _i = 0, dataNodeProps_2 = dataNodeProps; _i < dataNodeProps_2.length; _i++) {\n    var propName = dataNodeProps_2[_i];\n\n    if (props[propName] !== prevProps[propName]) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nvar hasStateChanged = function hasStateChanged(prevState, state) {\n  var keysICareAbout = [\"firebase\", \"value\", \"isLoading\", \"path\"];\n\n  for (var _i = 0, keysICareAbout_1 = keysICareAbout; _i < keysICareAbout_1.length; _i++) {\n    var propName = keysICareAbout_1[_i];\n\n    if (state[propName] !== prevState[propName]) {\n      return true;\n    }\n  }\n\n  return false;\n};\n\nvar reducers = {\n  setIsLoading: function setIsLoading(isLoading) {\n    return function (state) {\n      return produce(state, function (draft) {\n        draft.isLoading = isLoading;\n      });\n    };\n  },\n  setValue: function setValue(value) {\n    return function (state) {\n      return produce(state, function (draft) {\n        draft.value = value;\n      });\n    };\n  },\n  setPath: function setPath(path) {\n    return function (state) {\n      return produce(state, function (draft) {\n        draft.path = path;\n      });\n    };\n  },\n  addKeyToList: function addKeyToList(key) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [key];\n          return;\n        }\n\n        draft.value = draft.value.filter(function (k) {\n          return k !== key;\n        }).concat([key]);\n      });\n    };\n  },\n  removeKeyFromList: function removeKeyFromList(key) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [];\n          return;\n        }\n\n        draft.value = draft.value.filter(function (k) {\n          return k !== key;\n        });\n      });\n    };\n  },\n  addToList: function addToList(value, key, order) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [{\n            data: value,\n            key: key,\n            order: order\n          }];\n          return;\n        }\n\n        var orderedList = draft.value.filter(function (v) {\n          return v.key !== key;\n        }).concat([{\n          data: value,\n          key: key,\n          order: order\n        }]);\n        draft.value = orderedList.sort(function (a, b) {\n          return a.order - b.order;\n        });\n      });\n    };\n  },\n  removeFromList: function removeFromList(value, key) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [];\n          return;\n        }\n\n        draft.value = draft.value.filter(function (v) {\n          return v.key !== key;\n        });\n      });\n    };\n  },\n  removeFirstFromList: function removeFirstFromList(count) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [];\n          return;\n        }\n\n        var arrayLength = draft.value.length;\n        draft.value = draft.value.slice(arrayLength - count, arrayLength - 1);\n      });\n    };\n  },\n  removeLastFromList: function removeLastFromList(count) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [];\n          return;\n        }\n\n        var arrayLength = draft.value.length;\n        draft.value = draft.value.slice(0, arrayLength - count);\n      });\n    };\n  },\n  prependKeyToList: function prependKeyToList(key) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [key];\n          return;\n        }\n\n        draft.value = [key].concat(draft.value.filter(function (k) {\n          return k !== key;\n        }));\n      });\n    };\n  },\n  prependToList: function prependToList(value, key) {\n    return function (state) {\n      return produce(state, function (draft) {\n        if (!Array.isArray(draft.value)) {\n          draft.value = [{\n            data: value,\n            key: key\n          }];\n          return;\n        }\n\n        draft.value = [{\n          data: value,\n          key: key\n        }].concat(draft.value.filter(function (v) {\n          return v.key !== key;\n        }));\n      });\n    };\n  }\n};\n\nvar FirebaseDatabaseContextConsumerLifeCycle = function (_super) {\n  __extends(FirebaseDatabaseContextConsumerLifeCycle, _super);\n\n  function FirebaseDatabaseContextConsumerLifeCycle() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = {\n      firebase: null,\n      path: null,\n      orderByChild: null,\n      orderByKey: null,\n      orderByValue: null,\n      limitToFirst: null,\n      limitToLast: null,\n      startAt: null,\n      endAt: null,\n      equalTo: null,\n      keysOnly: null,\n      once: null,\n      isList: null,\n      unsub: null,\n      value: null,\n      isLoading: null\n    };\n    _this.__isMounted = false;\n\n    _this.ss = function () {\n      if (_this.__isMounted === false) {\n        return function () {};\n      }\n\n      return _this.setState.bind(_this);\n    };\n\n    _this.onValue = function (props, v) {\n      if (!v) return;\n      if (v.val() === null) return;\n      var value = v.val();\n      var keysOnly = props.keysOnly,\n          isList = props.isList,\n          orderByChild = props.orderByChild,\n          orderByKey = props.orderByKey,\n          orderByValue = props.orderByValue;\n\n      if (!keysOnly && !isList) {\n        _this.ss()(reducers.setValue(value));\n\n        return;\n      }\n\n      var unsortedKeys = keys(value);\n      var sortedKeys = orderByChild ? sortBy(unsortedKeys, function (key) {\n        return value[key][orderByChild];\n      }) : orderByKey ? sortBy(unsortedKeys, function (key) {\n        return key;\n      }) : orderByValue ? sortBy(unsortedKeys, function (key) {\n        return value[key];\n      }) : unsortedKeys;\n\n      if (keysOnly) {\n        _this.ss()(reducers.setValue(sortedKeys));\n\n        return;\n      }\n\n      if (isList) {\n        var val = sortedKeys.map(function (key) {\n          return {\n            key: key,\n            data: value[key]\n          };\n        });\n\n        _this.ss()(reducers.setValue(val));\n\n        return;\n      } else {\n        _this.ss()(reducers.setValue(value));\n\n        return;\n      }\n    };\n\n    _this.handleOnce = function (props, ref) {\n      _this.ss()(reducers.setIsLoading(true));\n\n      ref.once(\"value\", function (v) {\n        _this.ss()(reducers.setIsLoading(false));\n\n        _this.onValue(props, v);\n      });\n    };\n\n    _this.handleOn = function (props, ref) {\n      _this.unsub && _this.unsub();\n\n      _this.ss()(reducers.setIsLoading(true));\n\n      _this.unsub = ref.on(\"value\", function (v) {\n        _this.ss()(reducers.setIsLoading(false));\n\n        _this.onValue(props, v);\n      });\n    };\n\n    _this.listenToRef = function (props) {\n      var propsOrNull = getPropsOrNull(_this.props);\n      var firebase = propsOrNull.firebase,\n          path = propsOrNull.path;\n\n      if (firebase === null) {\n        return;\n      }\n\n      if (path === null) {\n        return;\n      }\n\n      _this.ss()(reducers.setPath(path));\n\n      _this.ss()(reducers.setIsLoading(true));\n\n      var query = getFirebaseQuery(propsOrNull);\n\n      if (propsOrNull.once) {\n        _this.handleOnce(props, query);\n      } else {\n        _this.handleOn(props, query);\n      }\n    };\n\n    return _this;\n  }\n\n  FirebaseDatabaseContextConsumerLifeCycle.prototype.componentDidMount = function () {\n    this.__isMounted = true;\n    this.listenToRef(getPropsOrNull(this.props));\n  };\n\n  FirebaseDatabaseContextConsumerLifeCycle.prototype.componentDidUpdate = function (prevProps) {\n    if (havePropsChanged(this.props, prevProps)) {\n      this.listenToRef(getPropsOrNull(this.props));\n    }\n  };\n\n  FirebaseDatabaseContextConsumerLifeCycle.prototype.componentWillUnmount = function () {\n    this.__isMounted = false;\n    this.unsub && this.unsub();\n  };\n\n  FirebaseDatabaseContextConsumerLifeCycle.prototype.shouldComponentUpdate = function (nextProps, nextState) {\n    return havePropsChanged(this.props, nextProps) || hasStateChanged(this.state, nextState);\n  };\n\n  FirebaseDatabaseContextConsumerLifeCycle.prototype.render = function () {\n    var _a = this.state,\n        path = _a.path,\n        value = _a.value,\n        isLoading = _a.isLoading;\n    return renderAndAddProps(this.props.children, {\n      path: path,\n      value: value,\n      isLoading: isLoading\n    });\n  };\n\n  return FirebaseDatabaseContextConsumerLifeCycle;\n}(Component);\n\nvar FirebaseDatabaseNode = function (_super) {\n  __extends(FirebaseDatabaseNode, _super);\n\n  function FirebaseDatabaseNode() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  FirebaseDatabaseNode.prototype.render = function () {\n    var _this = this;\n\n    var FirebaseDatabaseContextConsumer = getContext().FirebaseDatabaseContextConsumer;\n    return createElement(FirebaseDatabaseContextConsumer, null, function (context) {\n      return createElement(Fragment, null, createElement(FirebaseDatabaseContextConsumerLifeCycle, _assign({\n        firebase: context.firebase\n      }, _this.props)));\n    });\n  };\n\n  return FirebaseDatabaseNode;\n}(Component);\n\nvar initialState = {\n  isLoading: true,\n  value: {}\n};\n\nvar addNodeToState = function addNodeToState(state, _a) {\n  var id = _a.id,\n      value = _a.value,\n      isLoading = _a.isLoading;\n  var updatedState = produce$1(state, function (newState) {\n    set(newState, \"value.\" + id + \".value\", value);\n    set(newState, \"value.\" + id + \".isLoading\", isLoading);\n    return newState;\n  });\n  return updatedState;\n};\n\nvar PureNodeReader = function (_super) {\n  __extends(PureNodeReader, _super);\n\n  function PureNodeReader() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  PureNodeReader.prototype.componentDidMount = function () {\n    var _a = this.props,\n        id = _a.id,\n        value = _a.value,\n        isLoading = _a.isLoading,\n        onChange = _a.onChange;\n    onChange({\n      id: id,\n      value: value,\n      isLoading: isLoading,\n      onChange: onChange\n    });\n  };\n\n  PureNodeReader.prototype.componentDidUpdate = function () {\n    var _a = this.props,\n        id = _a.id,\n        value = _a.value,\n        isLoading = _a.isLoading,\n        onChange = _a.onChange;\n    onChange({\n      id: id,\n      value: value,\n      isLoading: isLoading,\n      onChange: onChange\n    });\n  };\n\n  PureNodeReader.prototype.shouldComponentUpdate = function (prevProps) {\n    var _a = this.props,\n        id = _a.id,\n        value = _a.value,\n        isLoading = _a.isLoading,\n        onChange = _a.onChange;\n    return prevProps.id !== id || prevProps.value !== value || prevProps.isLoading !== isLoading;\n  };\n\n  PureNodeReader.prototype.render = function () {\n    return null;\n  };\n\n  return PureNodeReader;\n}(Component);\n\nvar FirebaseDatabaseNodes = function (_super) {\n  __extends(FirebaseDatabaseNodes, _super);\n\n  function FirebaseDatabaseNodes() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.state = initialState;\n    return _this;\n  }\n\n  FirebaseDatabaseNodes.prototype.componentDidMount = function () {\n    var _loop_1 = function _loop_1(node) {\n      var id = node.id;\n      this_1.setState(function (state) {\n        return addNodeToState(state, {\n          id: id,\n          value: null,\n          isLoading: true\n        });\n      });\n    };\n\n    var this_1 = this;\n\n    for (var _i = 0, _a = this.props.nodes; _i < _a.length; _i++) {\n      var node = _a[_i];\n\n      _loop_1(node);\n    }\n  };\n\n  FirebaseDatabaseNodes.prototype.componentDidUpdate = function () {\n    var nodeIDs = this.props.nodes.map(function (n) {\n      return n.id;\n    });\n\n    var _loop_2 = function _loop_2(nodeID) {\n      if (!(nodeID in this_2.state.value)) {\n        this_2.setState(function (state) {\n          return addNodeToState(state, {\n            id: nodeID,\n            value: null,\n            isLoading: true\n          });\n        });\n      }\n    };\n\n    var this_2 = this;\n\n    for (var _i = 0, nodeIDs_1 = nodeIDs; _i < nodeIDs_1.length; _i++) {\n      var nodeID = nodeIDs_1[_i];\n\n      _loop_2(nodeID);\n    }\n  };\n\n  FirebaseDatabaseNodes.prototype.render = function () {\n    var _this = this;\n\n    return createElement(Fragment, null, this.props.nodes.map(function (node) {\n      return createElement(FirebaseDatabaseNode, _assign({\n        path: node.path,\n        key: node.id\n      }, node.query), function (_a) {\n        var value = _a.value,\n            isLoading = _a.isLoading;\n        return createElement(PureNodeReader, {\n          value: value,\n          isLoading: isLoading,\n          id: node.id,\n          onChange: function onChange(_a) {\n            var id = _a.id,\n                value = _a.value,\n                isLoading = _a.isLoading;\n\n            _this.setState(function (state) {\n              return addNodeToState(state, {\n                id: id,\n                value: value,\n                isLoading: isLoading\n              });\n            });\n          }\n        });\n      });\n    }), renderAndAddProps(this.props.children, this.state));\n  };\n\n  return FirebaseDatabaseNodes;\n}(PureComponent);\n\nvar FirebaseDatabaseMutationWithContext = function (_super) {\n  __extends(FirebaseDatabaseMutationWithContext, _super);\n\n  function FirebaseDatabaseMutationWithContext() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.createMutationRunner = function () {\n      var _a = _this.props,\n          firebase = _a.firebase,\n          path = _a.path,\n          type = _a.type;\n      var firebaseRef = firebase.app().database().ref(path);\n      var runMutation;\n\n      switch (type) {\n        case \"push\":\n          {\n            runMutation = function runMutation(value) {\n              return __awaiter(_this, void 0, void 0, function () {\n                var key;\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4, firebaseRef.push(value).key];\n\n                    case 1:\n                      key = _a.sent();\n                      return [2, {\n                        path: path,\n                        value: value,\n                        type: type,\n                        key: key\n                      }];\n                  }\n                });\n              });\n            };\n\n            break;\n          }\n\n        case \"update\":\n          {\n            runMutation = function runMutation(value) {\n              return __awaiter(_this, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4, firebaseRef.update(value)];\n\n                    case 1:\n                      _a.sent();\n\n                      return [2, {\n                        path: path,\n                        value: value,\n                        type: type,\n                        key: null\n                      }];\n                  }\n                });\n              });\n            };\n\n            break;\n          }\n\n        case \"set\":\n          {\n            runMutation = function runMutation(value) {\n              return __awaiter(_this, void 0, void 0, function () {\n                return __generator(this, function (_a) {\n                  switch (_a.label) {\n                    case 0:\n                      return [4, firebaseRef.set(value)];\n\n                    case 1:\n                      _a.sent();\n\n                      return [2, {\n                        path: path,\n                        value: value,\n                        type: type,\n                        key: null\n                      }];\n                  }\n                });\n              });\n            };\n\n            break;\n          }\n\n        default:\n          {\n            throw new Error(\"Unsupported mutation type \" + type + \". \\nPlease file an issue if you'd like to see us support it !\");\n          }\n      }\n\n      return runMutation;\n    };\n\n    return _this;\n  }\n\n  FirebaseDatabaseMutationWithContext.prototype.shouldComponentUpdate = function (nextProps) {\n    return nextProps.path !== this.props.path || nextProps.firebase !== this.props.firebase;\n  };\n\n  FirebaseDatabaseMutationWithContext.prototype.render = function () {\n    var children = this.props.children;\n    var runMutation = this.createMutationRunner();\n    return renderAndAddProps(children, _assign({\n      runMutation: runMutation\n    }, this.props));\n  };\n\n  return FirebaseDatabaseMutationWithContext;\n}(Component);\n\nvar FirebaseDatabaseMutation = function (_super) {\n  __extends(FirebaseDatabaseMutation, _super);\n\n  function FirebaseDatabaseMutation() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  FirebaseDatabaseMutation.prototype.render = function () {\n    var _a = this.props,\n        children = _a.children,\n        type = _a.type,\n        path = _a.path;\n    var FirebaseDatabaseContextConsumer = getContext().FirebaseDatabaseContextConsumer;\n    return createElement(FirebaseDatabaseContextConsumer, null, function (context) {\n      return createElement(FirebaseDatabaseMutationWithContext, _assign({\n        type: type,\n        path: path\n      }, context, {\n        children: children\n      }));\n    });\n  };\n\n  return FirebaseDatabaseMutation;\n}(Component);\n\nvar FirebaseDatabaseTransactionWithContext = function (_super) {\n  __extends(FirebaseDatabaseTransactionWithContext, _super);\n\n  function FirebaseDatabaseTransactionWithContext() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.createTransactionRunner = function () {\n      var _a = _this.props,\n          firebase = _a.firebase,\n          path = _a.path;\n      var firebaseRef = firebase.app().database().ref(path);\n\n      var runTransaction = function runTransaction(_a) {\n        var reducer = _a.reducer;\n        return __awaiter(_this, void 0, void 0, function () {\n          return __generator(this, function (_b) {\n            switch (_b.label) {\n              case 0:\n                return [4, firebaseRef.transaction(reducer)];\n\n              case 1:\n                _b.sent();\n\n                return [2, {\n                  path: path\n                }];\n            }\n          });\n        });\n      };\n\n      return runTransaction;\n    };\n\n    return _this;\n  }\n\n  FirebaseDatabaseTransactionWithContext.prototype.shouldComponentUpdate = function (nextProps) {\n    return nextProps.path !== this.props.path || nextProps.firebase !== this.props.firebase;\n  };\n\n  FirebaseDatabaseTransactionWithContext.prototype.render = function () {\n    var children = this.props.children;\n    var runTransaction = this.createTransactionRunner();\n    return renderAndAddProps(children, _assign({\n      runTransaction: runTransaction\n    }, this.props));\n  };\n\n  return FirebaseDatabaseTransactionWithContext;\n}(Component);\n\nvar FirebaseDatabaseTransaction = function (_super) {\n  __extends(FirebaseDatabaseTransaction, _super);\n\n  function FirebaseDatabaseTransaction() {\n    return _super !== null && _super.apply(this, arguments) || this;\n  }\n\n  FirebaseDatabaseTransaction.prototype.render = function () {\n    var _a = this.props,\n        children = _a.children,\n        path = _a.path;\n    var FirebaseDatabaseContextConsumer = getContext().FirebaseDatabaseContextConsumer;\n    return createElement(FirebaseDatabaseContextConsumer, null, function (context) {\n      return createElement(FirebaseDatabaseTransactionWithContext, _assign({\n        path: path\n      }, context, {\n        children: children\n      }));\n    });\n  };\n\n  return FirebaseDatabaseTransaction;\n}(Component);\n\nexport { FirebaseDatabaseNode, FirebaseDatabaseNodes, FirebaseDatabaseProvider, FirebaseDatabaseMutation, FirebaseDatabaseTransaction, getFirebaseQuery, initializeFirebaseApp };","map":null,"metadata":{},"sourceType":"module"}